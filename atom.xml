<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://mrwindlike.github.io/Note</id>
    <title>Windlikeçš„å°å±‹å­</title>
    <updated>2019-08-05T14:11:39.859Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://mrwindlike.github.io/Note"/>
    <link rel="self" href="https://mrwindlike.github.io/Note/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://mrwindlike.github.io/Note/images/avatar.png</logo>
    <icon>https://mrwindlike.github.io/Note/favicon.ico</icon>
    <rights>All rights reserved 2019, Windlikeçš„å°å±‹å­</rights>
    <entry>
        <title type="html"><![CDATA[Webpackä¼˜åŒ–ç­–ç•¥]]></title>
        <id>https://mrwindlike.github.io/Note/post/webpack-optimization</id>
        <link href="https://mrwindlike.github.io/Note/post/webpack-optimization">
        </link>
        <updated>2019-08-05T13:58:10.000Z</updated>
        <summary type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬æ–‡å†™çš„æ˜¯åŸºäº Webpack 4 æ‰€åšçš„ä¸€äº›ä¼˜åŒ–ï¼Œæ¯”å¦‚æé«˜æ„å»ºé€Ÿåº¦ï¼Œæé«˜æ„å»ºä»£ç çš„è´¨é‡ï¼Œæå‡å¼€å‘ä½“éªŒã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬æ–‡å†™çš„æ˜¯åŸºäº Webpack 4 æ‰€åšçš„ä¸€äº›ä¼˜åŒ–ï¼Œæ¯”å¦‚æé«˜æ„å»ºé€Ÿåº¦ï¼Œæé«˜æ„å»ºä»£ç çš„è´¨é‡ï¼Œæå‡å¼€å‘ä½“éªŒã€‚</p>
<!-- more -->
<h2 id="æ„å»ºä¼˜åŒ–">æ„å»ºä¼˜åŒ–</h2>
<h3 id="mode">Mode</h3>
<p>ä½¿ç”¨ <code>production</code> ç”Ÿäº§æ¨¡å¼ã€‚</p>
<pre><code class="language-js">module.exports = {
+  mode: 'production',
-  plugins: [
-    new UglifyJsPlugin(/* ... */),
-    new webpack.DefinePlugin({ &quot;process.env.NODE_ENV&quot;: JSON.stringify(&quot;production&quot;) }),
-    new webpack.optimize.ModuleConcatenationPlugin(),
-    new webpack.NoEmitOnErrorsPlugin()
-  ]
}
</code></pre>
<h3 id="module">Module</h3>
<h4 id="modulenoparse"><code>module.noParse</code></h4>
<p>è¿‡æ»¤ä¸éœ€è¦å¤„ç†çš„æ–‡ä»¶ï¼Œæ¯”å¦‚ä¸ä¾èµ–å…¶ä»–åº“çš„åº“ã€‚</p>
<pre><code class="language-js">module.exports = {
  ...
  module: {
    noParse: /node_modules\/(moment|chart|jquery|lodash\.js)/,
  }
};
</code></pre>
<h3 id="loaders">Loaders</h3>
<h4 id="ä¼˜åŒ–å»ºè®®">ä¼˜åŒ–å»ºè®®</h4>
<ul>
<li>ä½¿ç”¨ <code>include</code> å±æ€§å‘ŠçŸ¥ loader è¦æŸ¥æ‰¾çš„æ–‡ä»¶å¤¹</li>
<li>ä½¿ç”¨ <code>exclude</code> å±æ€§æ’é™¤ loader è¦æŸ¥æ‰¾çš„æ–‡ä»¶å¤¹</li>
<li>ä½¿ç”¨ happypack å¼€å¯å¤šçº¿ç¨‹å¤„ç†ï¼ˆè§ä¸‹æ–‡ï¼‰</li>
</ul>
<h4 id="babel-loader">babel-loader</h4>
<p>ä½¿ç”¨ <code>cacheDirectory</code> å±æ€§å°†è½¬æ¢ç»“æœç¼“å­˜ï¼ŒWebpack ä¼šå°è¯•è¯»å–ç¼“å­˜ï¼ŒåŠ å¿«æ„å»ºé€Ÿåº¦ã€‚</p>
<pre><code class="language-js">module.exports = {
  ...
  module: {
    rules: [
      {
        test: /\.js$/,
        include: path.resolve(__dirname, 'src'),
        exclude: path.resolve(__dirname, 'node_modules'),
        loader: 'babel-loader?cacheDirectory=true',  // ä½¿ç”¨ç¼“å­˜
      }
    ]
  }
};
</code></pre>
<h4 id="eslint-loader">eslint-loader</h4>
<p>åŒæ ·å¼€å¯ç¼“å­˜ã€‚</p>
<pre><code class="language-js">module.exports = {
  ...
  module: {
    rules: [
      {
        test: /\.(js|mjs|jsx)$/,
        enforce: 'pre',
        use: [
            {
              options: {
                cache: path.resolve('node_modules', '.cache', 'eslint-loader'),
              },
              loader: require.resolve('eslint-loader'),
            },
        ],
      }
    ]
  }
};
</code></pre>
<h4 id="cache-loader">cache-loader</h4>
<p>æœ‰äº› loader å¯èƒ½æ²¡æœ‰è‡ªå¸¦ç¼“å­˜åŠŸèƒ½ï¼Œå¯ä½¿ç”¨ cache-loader å¯¹ç»“æœè¿›è¡Œç¼“å­˜ã€‚</p>
<pre><code class="language-js">module.exports = {
  ...
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
            'style-loader',
            'css-loader',
            {
                loader: 'cache-loader',
                options: {
                    cacheDirectory: path.join('node_modules', '.cache', 'cache-loader-css')
                }
            }
        ]
      }
    ]
  }
};
</code></pre>
<h4 id="thread-loader">thread-loader</h4>
<p>å’Œ happypck ç±»ä¼¼ï¼Œå®ƒä¼šæŠŠ loader æ”¾è¿›ä¸€ä¸ªå•ç‹¬çš„ worker æ± ä¸­è¿è¡Œã€‚</p>
<pre><code class="language-js">module.exports = {
  module: {
    rules: [
      {
        test: /\.js$/,
        include: path.resolve(&quot;src&quot;),
        use: [
          &quot;thread-loader&quot;,
          // your expensive loader (e.g babel-loader)
        ]
      }
    ]
  }
}
</code></pre>
<h3 id="resolve">Resolve</h3>
<h4 id="resolvemodules"><code>resolve.modules</code></h4>
<pre><code class="language-js">module.exports = {
    ...
    resolve: {
      modules: [path.resolve(__dirname, 'node_modules')]
    }
};
</code></pre>
<h4 id="resolvealias"><code>resolve.alias</code></h4>
<p>å¯é€šè¿‡ <code>resolve.alias</code> å±æ€§ç›´æ¥ä½¿ç”¨åº“çš„ç”Ÿäº§ç‰ˆæœ¬ï¼ŒWebpack ä¸å¿…å†å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚å¦å¤–è¿˜å¯ä»¥å¯¹æ–‡ä»¶è·¯å¾„ä½¿ç”¨åˆ«åï¼Œæ–¹ä¾¿å¼•ç”¨æ–‡ä»¶ã€‚</p>
<pre><code class="language-js">module.exports = {
    ...
    resolve: {
      alias: {
        Components: path.resolve(__dirname, 'src/components/'),
        Utils: path.resolve(__dirname, 'src/utils/'),
        react: patch.resolve(__dirname, './node_modules/react/dist/react.min.js')
      }
    }
};
</code></pre>
<pre><code class="language-js">// import Component form 'src/components/component';
import Component form 'Components/component';
</code></pre>
<p>ä½†æ˜¯ä½¿ç”¨åˆ«åè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ VSCode æ— æ³•æ‰¾åˆ°ç›¸å…³çš„å¼•ç”¨æ–‡ä»¶ï¼Œè§£å†³åŠæ³•å°±æ˜¯æ·»åŠ  <code>jsconfig.json</code> æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥æ„‰å¿«åœ°ä½¿ç”¨ VSCode å•¦ï¼</p>
<pre><code class="language-json">// jsconfig.json
{
  &quot;compilerOptions&quot;: {
    &quot;baseUrl&quot;: &quot;.&quot;,
    &quot;paths&quot;: {
      &quot;Components/*&quot;: [&quot;./src/components/*&quot;],
      &quot;Utils/*&quot;: [&quot;./src/assets/*&quot;],
    }
  },
  &quot;include&quot;: [&quot;./src/**/*&quot;]
}
</code></pre>
<h4 id="resolveextensions"><code>resolve.extensions</code></h4>
<p>è®¾ç½® <code>resolve.extensions</code> å±æ€§å‘ŠçŸ¥ Webpack éœ€è¦å¤„ç†çš„æ–‡ä»¶ç±»å‹ã€‚</p>
<pre><code class="language-js">module.exports = {
  ...,
  resolve: {
    extensions: ['.js', '.json', 'jsx']
  }
}
</code></pre>
<h3 id="optimization">Optimization</h3>
<h4 id="optimizationsplitchunks"><code>optimization.splitChunks</code></h4>
<p>æŠŠå¤šæ¬¡å¼•ç”¨çš„ä»£ç æå–åˆ° chunks æ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡åŠ¨æ€åŠ è½½çš„æ–¹å¼ä½¿ç”¨ï¼Œå¯ä»¥æé«˜é¦–å±åŠ è½½é€Ÿåº¦ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½è¿‡å¤šçš„è„šæœ¬ä»£ç ã€‚</p>
<pre><code class="language-js">module.exports = {
  ...
  optimization: {
    ...
    splitChunks: {
      chunks: 'all',
      name: true,
      automaticNameDelimiter: '-',
      cacheGroups: {
        vendors: {
          test: /[\\/]node_modules[\\/]/,
          priority: -10  // ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
        },
        react: {
          test({ resource }) {
            return /[\\/]node_modules[\\/](react|redux)/.test(resource);
          },
          name: 'react',
          priority: -15,
          reuseExistingChunk: true,
        },
        antd: {
          test: /[\\/]node_modules[\\/]antd/,
          name: 'antd',
          priority: -15,
          reuseExistingChunk: true,
        },
        default: {  // é»˜è®¤è®¾ç½®ï¼Œå¯è¢«é‡å†™
          minChunks: 2,  // æœ€å°è¢«å¼•ç”¨æ•°ï¼Œåªæœ‰å¤§äºè¿™ä¸ªå€¼æ‰ä¼šè¢«åˆ†ç¦»å‡º chunks
          priority: -20,
          reuseExistingChunk: true  // é‡ç”¨å·²å­˜åœ¨çš„ chunks
        }
      }
    }
  },
}

</code></pre>
<h4 id="optimizationruntimechunk"><code>optimization.runtimeChunk</code></h4>
<p>å½“è¯¥å±æ€§è¢«è®¾ä¸º <code>singin</code> æˆ–è€… <code>{ name: 'string' }</code> æ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ‰€æœ‰ chunks å…±äº«çš„è¿è¡Œæ—¶æ–‡ä»¶ï¼Œè€Œä¸æ˜¯æ¯ä¸ª chunks éƒ½ä¼šåŒ…å«è¿è¡Œæ—¶çš„ä»£ç ï¼Œå‡å°æ–‡ä»¶ä½“ç§¯ã€‚</p>
<pre><code class="language-js">module.exports = {
  //...
  optimization: {
    runtimeChunk: {
      name: 'runtime'
    }
  }
};
</code></pre>
<h3 id="plugins">Plugins</h3>
<h4 id="happypack">happypack</h4>
<p>ä½¿ç”¨ happypack æ¥è®© loader å¼€å¯å¤šçº¿å¤„ç†æ–‡ä»¶ï¼Œæœ‰äº› loader æ˜¯ä¸æ”¯æŒä½¿ç”¨ happypack çš„ï¼Œéœ€è¦è‡ªè¡Œå°è¯•ã€‚å°½é‡åªå¯ç”¨éœ€è¦å¤„ç†å¤§é‡æ–‡ä»¶çš„ loader ï¼Œå› ä¸ºå¯åŠ¨çº¿ç¨‹ä¹Ÿéœ€è¦èŠ±è´¹è®¸å¤šæ—¶é—´ã€‚</p>
<pre><code class="language-js">var HappyPack = require('happypack');

module.exports = {
    ...
    rules: [
      {
        test: /\.(js|jsx)$/,
        include: path.resolve(__dirname, 'src'),
        exclude: path.resolve(__dirname, 'node_modules'),
        use: 'happypack/loader?id=babel'
      },
    ],
    plugins: [
      new HappyPack({
        threads: 2,  // çº¿ç¨‹æ•°
        id: 'babel',
        loaders: ['babel-loader?cacheDirectory=true']
      }),
    ],
}

</code></pre>
<h4 id="lodash-webpack-plugin">lodash-webpack-plugin</h4>
<p>æŒ‰éœ€æ‰“åŒ… lodash ã€‚</p>
<pre><code class="language-js">const LodashPlugin = require('lodash-webpack-plugin');

module.exports = {
    plugins: [
      new LodashPlugin(),
    ],
}
</code></pre>
<h2 id="å¼€å‘ä¼˜åŒ–">å¼€å‘ä¼˜åŒ–</h2>
<h3 id="mode-2">Mode</h3>
<p>å¯ç”¨ <code>development</code> å¼€å‘æ¨¡å¼ã€‚</p>
<pre><code class="language-js">module.exports = {
+ mode: 'development'
- devtool: 'eval',
- plugins: [
-   new webpack.NamedModulesPlugin(),
-   new webpack.NamedChunksPlugin(),
-   new webpack.DefinePlugin({ &quot;process.env.NODE_ENV&quot;: JSON.stringify(&quot;development&quot;) }),
- ]
}
</code></pre>
<h3 id="plugins-2">Plugins</h3>
<h4 id="provideplugin">ProvidePlugin</h4>
<p>è¯¥æ’ä»¶ä¼šè‡ªåŠ¨å¼•ç”¨æ‰€å®šä¹‰å¥½çš„åº“ã€‚</p>
<pre><code class="language-js">module.exports = {
    plugins: [
        new webpack.ProvidePlugin({
            $: 'jquery',
            jQuery: 'jquery',
            Vue: 'vue',
            mapState: ['vuex', 'mapState'],
            mapActions: ['vuex', 'mapActions']
        })
    ]
}

</code></pre>
<p>ç„¶ååœ¨é¡¹ç›®ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›å˜é‡ï¼Œè€Œæ— éœ€å¼•å…¥ã€‚</p>
<pre><code class="language-js">// import Vue from 'vue';

new Vue({...});

</code></pre>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<ol>
<li>ä¸åŒç¯å¢ƒä¸‹ä½¿ç”¨ä¸åŒçš„ Webpack æ¨¡å¼ï¼›</li>
<li>å®šä¹‰å¥½è¦ Webpack æ‰€å¤„ç†çš„æ–‡ä»¶å’Œæ— éœ€å¤„ç†çš„æ–‡ä»¶ï¼ˆæ–‡ä»¶ç±»å‹ã€æ–‡ä»¶è·¯å¾„ç­‰ç­‰ï¼‰ï¼›</li>
<li>ä½¿ç”¨ loader çš„ç¼“å­˜åŠŸèƒ½ï¼Œå°†æ„å»ºç»“æœç¼“å­˜ï¼Œå¹¶ä¸”ä½¿ç”¨ç›¸å…³å·¥å…·ï¼ˆhappypack, thread-loaderï¼‰å¼€å¯å¤šçº¿ç¨‹å¤„ç†è€—æ—¶è¾ƒå¤§çš„ loaderï¼›</li>
<li>é‡ç”¨å·²å­˜åœ¨çš„ chunksï¼›</li>
<li>å¼€å‘ç¯å¢ƒä¸‹å–æ¶ˆæ„å»ºçš„ä¸€äº›ä»£ç ä¼˜åŒ–ï¼ˆå‹ç¼©ä»£ç ï¼Œä»£ç è½¬æ¢ç­‰ç­‰ï¼‰ï¼›</li>
<li>ä½¿ç”¨ ProvidePlugin è‡ªåŠ¨å¼•ç”¨ç›¸å…³çš„åº“æ–‡ä»¶ï¼›</li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Reactæºç é˜…è¯»â€”â€”è™šæ‹ŸDOM]]></title>
        <id>https://mrwindlike.github.io/Note/post/react-yuan-ma-yue-du-xu-ni-dom</id>
        <link href="https://mrwindlike.github.io/Note/post/react-yuan-ma-yue-du-xu-ni-dom">
        </link>
        <updated>2019-04-30T15:00:49.000Z</updated>
        <summary type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦æ¢ç©¶ React ä¸­è™šæ‹Ÿ DOM æ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼Œä»¥åŠå®ƒæ˜¯å¦‚ä½•è½¬æ¢æˆçœŸå®çš„ DOM èŠ‚ç‚¹çš„ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦æ¢ç©¶ React ä¸­è™šæ‹Ÿ DOM æ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼Œä»¥åŠå®ƒæ˜¯å¦‚ä½•è½¬æ¢æˆçœŸå®çš„ DOM èŠ‚ç‚¹çš„ã€‚</p>
<!-- more -->
<h1 id="å‰è¨€">å‰è¨€</h1>
<p>æœ¬æ–‡çš„ä¸»è¦ç›®çš„æ˜¯é˜…è¯»æºç çš„è¿‡ç¨‹ä¸­åšä¸‹ç¬”è®°å’Œåˆ†äº«ç»™æœ‰éœ€è¦çš„å°ä¼™ä¼´ï¼Œå¯èƒ½ä¼šæœ‰çº°æ¼å’Œé”™è¯¯ï¼Œè¯·è¯»è€…è‡ªè¡Œåˆ¤æ–­ï¼Œå¤´ä¸€æ¬¡å†™é˜…è¯»ä»£ç çš„æ–‡ç« ï¼Œå¯èƒ½å†™å¾—æœ‰ç‚¹ä¹±ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜æ¬¢è¿ä¸€èµ·æ¢è®¨ä¸€èµ·è¿›æ­¥ã€‚</p>
<p>Reactçš„ç‰ˆæœ¬ä¸º16.4ï¼Œä¸»åˆ†æ”¯çš„ä»£ç ï¼Œåªè´´å‡ºéƒ¨åˆ†å…³é”®ä»£ç ï¼Œå®Œæ•´ä»£ç è¯·åˆ°GithubæŸ¥çœ‹ã€‚</p>
<h2 id="åŒç³»åˆ—æ–‡ç« ">åŒç³»åˆ—æ–‡ç« </h2>
<p>å› ä¸ºæ¯æ¬¡æ›´æ–°æ–‡ç« éƒ½è¦æ›´æ–°ä¸€éç›®å½•å¤ªéº»çƒ¦ï¼Œæ‰€ä»¥æœ¬ç³»åˆ—çš„æ–‡ç« éƒ½æ•´åˆåˆ°Githubï¼Œæœ‰å…´è¶£é˜…è¯»æ›´å¤šReactæºç é˜…è¯»æ–‡ç« çš„åŒå­¦å¯ä»¥ç”¨åŠ›ç‚¹<a href="https://github.com/MrWindlike/React-Source-Reading">è¿™é‡Œè¿™é‡Œè¿™é‡Œ</a>ï¼Œå¦‚æœè§‰å¾—æ–‡ç« å†™å¾—è¿˜è¡Œçš„è¯ï¼Œå¯¹ä½ æœ‰å°å°çš„å¸®åŠ©ï¼Œå¸Œæœ›å¯ä»¥ç»™é¢—å°æ˜Ÿæ˜Ÿç»™æˆ‘ï¼Œè°¢è°¢ğŸ˜œ</p>
<h1 id="è™šæ‹Ÿdomçš„åˆå§‹åŒ–">è™šæ‹ŸDOMçš„åˆå§‹åŒ–</h1>
<h2 id="reactcreateelement">React.createElement</h2>
<p>åœ¨é˜…è¯»æºç å‰ï¼Œæˆ‘ä»¬å…ˆæå‡ºä¸€ä¸ªé—®é¢˜ï¼ŒReactæ˜¯å¦‚ä½•å°†è™šæ‹ŸDOMè½¬æ¢ä¸ºçœŸå®çš„DOMå‘¢ï¼Ÿæœ‰é—®é¢˜ä»¥åæˆ‘ä»¬æ‰ä¼šæ›´æœ‰ç›®æ ‡çš„é˜…è¯»ä»£ç ï¼Œä¸‹é¢æˆ‘ä»¬å°±å¸¦ç€è¿™ä¸ªé—®é¢˜å»æ€è€ƒã€‚</p>
<p>åœ¨å¹³æ—¶å·¥ä½œä¸­æˆ‘ä»¬å¸¸å¸¸ç”¨JSXè¯­æ³•æ¥åˆ›å»ºReactå…ƒç´ å®ä¾‹ï¼Œä½†ä»–ä»¬æœ€åéƒ½ä¼šé€šè¿‡æ‰“åŒ…å·¥å…·ç¼–è¯‘æˆåŸç”Ÿçš„JSä»£ç ï¼Œé€šè¿‡React.createElementæ¥åˆ›å»ºã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-javascript">//  class ReactComponent extends React.Component {
//      render() {
//          return &lt;p className=&quot;class&quot;&gt;Hello React&lt;/p&gt;;
//      }
//  }
//  ä»¥ä¸Šä»£ç ä¼šç¼–è¯‘ä¸ºï¼š
class ReactComponent extends React.Component {
    render() {
        React.createElement(
          'p',
          { className: 'class'},
          'Hello React'
        )
    }
}

//  &lt;ReactComponent someProp=&quot;prop&quot; /&gt;
React.createElement(ReactComponent, { someProp: 'prop' }, null);

</code></pre>
<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºå¾—åˆ°Reactå…ƒç´ å®ä¾‹ã€‚<br>
å…ˆæ¥çœ‹çœ‹createElementçš„ä¸»è¦æºç ï¼ˆéƒ¨åˆ†ä»£ç çœç•¥ï¼‰ï¼š</p>
<pre><code class="language-javascript">function createElement(type, config, children) {
  let propName;

  const props = {};

  let key = null;
  let ref = null;
  let self = null;
  let source = null;

  if (config != null) {
    if (hasValidRef(config)) {
      //  å¦‚æœæœ‰refï¼Œå°†ä»–å–å‡ºæ¥
      ref = config.ref;
    }
    if (hasValidKey(config)) {
      //  å¦‚æœæœ‰keyï¼Œå°†ä»–å–å‡ºæ¥
      key = '' + config.key;
    }

    self = config.__self === undefined ? null : config.__self;
    source = config.__source === undefined ? null : config.__source;
    
    for (propName in config) {
      if (
        hasOwnProperty.call(config, propName) &amp;&amp;
        !RESERVED_PROPS.hasOwnProperty(propName)
      ) {
        //  å°†é™¤refï¼Œkeyç­‰è¿™äº›ç‰¹æ®Šçš„å±æ€§æ”¾åˆ°æ–°çš„propså¯¹è±¡é‡Œ
        props[propName] = config[propName];
      }
    }
  }

  //  è·å–å­å…ƒç´ 
  const childrenLength = arguments.length - 2;
  if (childrenLength === 1) {
    props.children = children;
  } else if (childrenLength &gt; 1) {
    const childArray = Array(childrenLength);
    for (let i = 0; i &lt; childrenLength; i++) {
      childArray[i] = arguments[i + 2];
    }
    props.children = childArray;
  }

  //  æ·»åŠ é»˜è®¤props
  if (type &amp;&amp; type.defaultProps) {
    const defaultProps = type.defaultProps;
    for (propName in defaultProps) {
      if (props[propName] === undefined) {
        props[propName] = defaultProps[propName];
      }
    }
  }
  
  return ReactElement(
    type,
    key,
    ref,
    self,
    source,
    ReactCurrentOwner.current,
    props,
  );
}
</code></pre>
<pre><code class="language-javascript">const ReactElement = function(type, key, ref, self, source, owner, props) {
  //  æœ€ç»ˆå¾—åˆ°çš„Reactå…ƒç´ 
  const element = {
    // This tag allows us to uniquely identify this as a React Element
    $$typeof: REACT_ELEMENT_TYPE,

    // Built-in properties that belong on the element
    type: type,
    key: key,
    ref: ref,
    props: props,

    // Record the component responsible for creating this element.
    _owner: owner,
  };

  return element;
};
</code></pre>
<p>æ˜¯ä¸æ˜¯å¾ˆç®€å•å‘¢ï¼Œä¸»è¦æ˜¯æŠŠæˆ‘ä»¬ä¼ è¿›å»çš„ä¸œè¥¿ç»„æˆä¸€ä¸ªReactå…ƒç´ å¯¹è±¡ï¼Œè€Œtypeå°±æ˜¯æˆ‘ä»¬ä¼ è¿›å»çš„ç»„ä»¶ç±»å‹ï¼Œä»–å¯ä»¥æ˜¯ä¸€ä¸ªç±»ã€å‡½æ•°æˆ–å­—ç¬¦ä¸²ï¼ˆå¦‚'div'ï¼‰ã€‚</p>
<h2 id="reactdomrender">ReactDom.render</h2>
<p>è™½ç„¶æˆ‘ä»¬å·²ç»å¾—åˆ°åˆ›å»ºå¥½çš„Reactå…ƒç´ ï¼Œä½†Reactæœ‰æ˜¯å¦‚ä½•æŠŠReactå…ƒç´ è½¬æ¢ä¸ºæˆ‘ä»¬æœ€ç»ˆæƒ³è¦çš„DOMå‘¢ï¼Ÿå°±æ˜¯é€šè¿‡ReactDom.renderå‡½æ•°å•¦ã€‚</p>
<pre><code class="language-javascript">ReactDom.render(
  React.createElement(App),  
  document.getElementById('root')
 );
</code></pre>
<p>ReactDom.renderçš„å®šä¹‰ï¼š</p>
<pre><code class="language-javascript">render(
    element: React$Element&lt;any&gt;,
    container: DOMContainer,
    callback: ?Function,
  ) {
    return legacyRenderSubtreeIntoContainer(
      null,  /* çˆ¶ç»„ä»¶ */
      element,  /* Reactå…ƒç´  */
      container,  /* DOMå®¹å™¨ */
      false,
      callback,
    );
  }
</code></pre>
<p>legacyRenderSubtreeIntoContainerå…ˆè·å–åˆ°Reactæ ¹å®¹å™¨å¯¹è±¡ï¼ˆåªè´´éƒ¨åˆ†ä»£ç ï¼‰ï¼š</p>
<pre><code class="language-javascript">...
root = container._reactRootContainer = legacyCreateRootFromDOMContainer(
  container,
  forceHydrate,
);
...
</code></pre>
<p>å› ä»£ç è¿‡å¤šåªè´´å‡ºé€šè¿‡legacyCreateRootFromDOMContaineræœ€ç»ˆå¾—åˆ°çš„Reactæ ¹å®¹å™¨å¯¹è±¡ï¼š</p>
<pre><code class="language-javascript">const NoWork = 0;

{
    _internalRoot: {
      current: uninitializedFiber,  // null
      containerInfo: containerInfo,  //  DOMå®¹å™¨
      pendingChildren: null,

      earliestPendingTime: NoWork,
      latestPendingTime: NoWork,
      earliestSuspendedTime: NoWork,
      latestSuspendedTime: NoWork,
      latestPingedTime: NoWork,

      didError: false,

      pendingCommitExpirationTime: NoWork,
      finishedWork: null,
      context: null,
      pendingContext: null,
      hydrate,
      nextExpirationTimeToWorkOn: NoWork,
      expirationTime: NoWork,
      firstBatch: null,
      nextScheduledRoot: null,
    },
    render: (children: ReactNodeList, callback: ?() =&gt; mixed) =&gt; Work,
    legacy_renderSubtreeIntoContainer: (
      parentComponent: ?React$Component&lt;any, any&gt;,
      children: ReactNodeList,
      callback: ?() =&gt; mixed
    ) =&gt; Work,
    createBatch: () =&gt; Batch
}
</code></pre>
<p>åœ¨åˆå§‹åŒ–Reactæ ¹å®¹å™¨å¯¹è±¡rootåï¼Œè°ƒç”¨root.renderå¼€å§‹è™šæ‹ŸDOMçš„æ¸²æŸ“è¿‡ç¨‹ã€‚</p>
<pre><code class="language-javascript">DOMRenderer.unbatchedUpdates(() =&gt; {
  if (parentComponent != null) {
    root.legacy_renderSubtreeIntoContainer(
      parentComponent,
      children,
      callback,
    );
  } else {
    root.render(children, callback);
  }
});
</code></pre>
<p>å› ä»£ç é‡è¿‡å¤§ï¼Œå°±ä¸é€ä¸€è´´å‡ºè¯¦ç»†ä»£ç ï¼Œåªè´´å‡ºä¸»è¦çš„å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ã€‚</p>
<pre><code class="language-javascript">root.render(children, callback) -&gt; 
DOMRenderer.updateContainer(children, root, null, work._onCommit) -&gt; 
updateContainerAtExpirationTime(
    element,
    container,
    parentComponent,
    expirationTime,
    callback,
) -&gt;
scheduleRootUpdate(current, element, expirationTime, callback) -&gt;
scheduleWork(current, expirationTime) -&gt;
requestWork(root, rootExpirationTime) -&gt;
performWorkOnRoot(root, Sync, false) -&gt;
renderRoot(root, false) -&gt; 
workLoop(isYieldy) -&gt;
performUnitOfWork(nextUnitOfWork: Fiber) =&gt; Fiber | null -&gt;
beginWork(current, workInProgress, nextRenderExpirationTime)
</code></pre>
<h3 id="fiber">Fiber</h3>
<p>Fiberç±»å‹ï¼š</p>
<pre><code class="language-javascript">type Fiber = {|
  tag: TypeOfWork,
  key: null | string,

  // The function/class/module associated with this fiber.
  type: any,
  return: Fiber | null,

  // Singly Linked List Tree Structure.
  child: Fiber | null,
  sibling: Fiber | null,
  index: number,
  ref: null | (((handle: mixed) =&gt; void) &amp; {_stringRef: ?string}) | RefObject,

  memoizedProps: any, // The props used to create the output.
  updateQueue: UpdateQueue&lt;any&gt; | null,
  memoizedState: any,
  
  mode: TypeOfMode,

  effectTag: TypeOfSideEffect,
  nextEffect: Fiber | null,
  firstEffect: Fiber | null,
  lastEffect: Fiber | null,
  
  expirationTime: ExpirationTime,

  alternate: Fiber | null,

  actualDuration?: number,
  actualStartTime?: number,
  selfBaseTime?: number,
  treeBaseTime?: number,

  _debugID?: number,
  _debugSource?: Source | null,
  _debugOwner?: Fiber | null,
  _debugIsCurrentlyTiming?: boolean,
|};
</code></pre>
<h3 id="beginwork">beginWork</h3>
<p>æŒ‰ä»¥ä¸Šå‡½æ•°è°ƒç”¨è¿‡ç¨‹ï¼Œæˆ‘ä»¬æ¥åˆ°beginWorkå‡½æ•°ï¼Œå®ƒçš„ä½œç”¨ä¸»è¦æ˜¯æ ¹æ®Fiberå¯¹è±¡çš„tagæ¥å¯¹ç»„ä»¶è¿›è¡Œmountæˆ–updateï¼š</p>
<pre><code class="language-javascript">function beginWork(
  current: Fiber | null,
  workInProgress: Fiber,
  renderExpirationTime: ExpirationTime,
): Fiber | null {
  if (enableProfilerTimer) {
    if (workInProgress.mode &amp; ProfileMode) {
      markActualRenderTimeStarted(workInProgress);
    }
  }

  if (
    workInProgress.expirationTime === NoWork ||
    workInProgress.expirationTime &gt; renderExpirationTime
  ) {
    return bailoutOnLowPriority(current, workInProgress);
  }

  //  æ ¹æ®ç»„ä»¶ç±»å‹æ¥è¿›è¡Œä¸åŒå¤„ç†
  switch (workInProgress.tag) {
    case IndeterminateComponent:
      //  ä¸ç¡®å®šçš„ç»„ä»¶ç±»å‹
      return mountIndeterminateComponent(
        current,
        workInProgress,
        renderExpirationTime,
      );
    case FunctionalComponent:
      //  å‡½æ•°ç±»å‹çš„ç»„ä»¶
      return updateFunctionalComponent(current, workInProgress);
    case ClassComponent:
      //  ç±»ç±»å‹çš„ç»„ä»¶ï¼Œæˆ‘ä»¬è¿™æ¬¡ä¸»è¦çœ‹è¿™ä¸ª
      return updateClassComponent(
        current,
        workInProgress,
        renderExpirationTime,
      );
    case HostRoot:
      return updateHostRoot(current, workInProgress, renderExpirationTime);
    case HostComponent:
      return updateHostComponent(current, workInProgress, renderExpirationTime);
    case HostText:
      return updateHostText(current, workInProgress);
    case TimeoutComponent:
      return updateTimeoutComponent(
        current,
        workInProgress,
        renderExpirationTime,
      );
    case HostPortal:
      return updatePortalComponent(
        current,
        workInProgress,
        renderExpirationTime,
      );
    case ForwardRef:
      return updateForwardRef(current, workInProgress);
    case Fragment:
      return updateFragment(current, workInProgress);
    case Mode:
      return updateMode(current, workInProgress);
    case Profiler:
      return updateProfiler(current, workInProgress);
    case ContextProvider:
      return updateContextProvider(
        current,
        workInProgress,
        renderExpirationTime,
      );
    case ContextConsumer:
      return updateContextConsumer(
        current,
        workInProgress,
        renderExpirationTime,
      );
    default:
      invariant(
        false,
        'Unknown unit of work tag. This error is likely caused by a bug in ' +
          'React. Please file an issue.',
      );
  }
}
</code></pre>
<h3 id="updateclasscomponent">updateClassComponent</h3>
<p>updateClassComponentçš„ä½œç”¨æ˜¯å¯¹æœªåˆå§‹åŒ–çš„ç±»ç»„ä»¶è¿›è¡Œåˆå§‹åŒ–ï¼Œå¯¹å·²ç»åˆå§‹åŒ–çš„ç»„ä»¶æ›´æ–°é‡ç”¨</p>
<pre><code class="language-javascript">function updateClassComponent(
  current: Fiber | null,
  workInProgress: Fiber,
  renderExpirationTime: ExpirationTime,
) {
  const hasContext = pushLegacyContextProvider(workInProgress);
  let shouldUpdate;
  if (current === null) {
    if (workInProgress.stateNode === null) {
      //  å¦‚æœè¿˜æ²¡åˆ›å»ºå®ä¾‹ï¼Œåˆå§‹åŒ–
      constructClassInstance(
        workInProgress,
        workInProgress.pendingProps,
        renderExpirationTime,
      );
      mountClassInstance(workInProgress, renderExpirationTime);

      shouldUpdate = true;
    } else {
      //  å¦‚æœå·²ç»åˆ›å»ºå®ä¾‹ï¼Œåˆ™é‡ç”¨å®ä¾‹
      shouldUpdate = resumeMountClassInstance(
        workInProgress,
        renderExpirationTime,
      );
    }
  } else {
    shouldUpdate = updateClassInstance(
      current,
      workInProgress,
      renderExpirationTime,
    );
  }
  return finishClassComponent(
    current,
    workInProgress,
    shouldUpdate,
    hasContext,
    renderExpirationTime,
  );
}
</code></pre>
<h3 id="constructclassinstance">constructClassInstance</h3>
<p>å®ä¾‹åŒ–ç±»ç»„ä»¶ï¼š</p>
<pre><code class="language-javascript">function constructClassInstance(
  workInProgress: Fiber,
  props: any,
  renderExpirationTime: ExpirationTime,
): any {
  const ctor = workInProgress.type;  //  æˆ‘ä»¬ä¼ è¿›å»çš„é‚£ä¸ªç±»
  const unmaskedContext = getUnmaskedContext(workInProgress);
  const needsContext = isContextConsumer(workInProgress);
  const context = needsContext
    ? getMaskedContext(workInProgress, unmaskedContext)
    : emptyContextObject;

  const instance = new ctor(props, context);  //  åˆ›å»ºå®ä¾‹
  const state = (workInProgress.memoizedState =
    instance.state !== null &amp;&amp; instance.state !== undefined
      ? instance.state
      : null);
  adoptClassInstance(workInProgress, instance);

  if (needsContext) {
    cacheContext(workInProgress, unmaskedContext, context);
  }

  return instance;
}
</code></pre>
<h3 id="adoptclassinstance">adoptClassInstance</h3>
<pre><code class="language-javascript">function adoptClassInstance(workInProgress: Fiber, instance: any): void {
  instance.updater = classComponentUpdater;
  workInProgress.stateNode = instance;  //  å°†å®ä¾‹èµ‹å€¼ç»™stateNodeå±æ€§
}
</code></pre>
<h3 id="mountclassinstance">mountClassInstance</h3>
<p>ä¸‹é¢çš„ä»£ç å°±æœ‰æˆ‘ä»¬ç†Ÿæ‚‰çš„componentWillMountç”Ÿå‘½å‘¨æœŸå‡ºç°å•¦ï¼Œä¸è¿‡æ–°ç‰ˆReactå·²ç»ä¸å»ºè®®ä½¿ç”¨å®ƒã€‚</p>
<pre><code class="language-javascript">function mountClassInstance(
  workInProgress: Fiber,
  renderExpirationTime: ExpirationTime,
): void {
  const ctor = workInProgress.type;

  const instance = workInProgress.stateNode;
  const props = workInProgress.pendingProps;
  const unmaskedContext = getUnmaskedContext(workInProgress);

  instance.props = props;
  instance.state = workInProgress.memoizedState;
  instance.refs = emptyRefsObject;
  instance.context = getMaskedContext(workInProgress, unmaskedContext);

  let updateQueue = workInProgress.updateQueue;
  if (updateQueue !== null) {
    processUpdateQueue(
      workInProgress,
      updateQueue,
      props,
      instance,
      renderExpirationTime,
    );
    instance.state = workInProgress.memoizedState;
  }

  const getDerivedStateFromProps = workInProgress.type.getDerivedStateFromProps;
  if (typeof getDerivedStateFromProps === 'function') {
    //  Reactæ–°çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°
    applyDerivedStateFromProps(workInProgress, getDerivedStateFromProps, props);
    instance.state = workInProgress.memoizedState;
  }

  if (
    typeof ctor.getDerivedStateFromProps !== 'function' &amp;&amp;
    typeof instance.getSnapshotBeforeUpdate !== 'function' &amp;&amp;
    (typeof instance.UNSAFE_componentWillMount === 'function' ||
      typeof instance.componentWillMount === 'function')
  ) {
    //  å¦‚æœæ²¡æœ‰ä½¿ç”¨getDerivedStateFromPropsè€Œä½¿ç”¨componentWillMountï¼Œå…¼å®¹æ—§ç‰ˆ
    callComponentWillMount(workInProgress, instance);
    updateQueue = workInProgress.updateQueue;
    if (updateQueue !== null) {
      processUpdateQueue(
        workInProgress,
        updateQueue,
        props,
        instance,
        renderExpirationTime,
      );
      instance.state = workInProgress.memoizedState;
    }
  }

  if (typeof instance.componentDidMount === 'function') {
    workInProgress.effectTag |= Update;
  }
}
</code></pre>
<h3 id="finishclasscomponent">finishClassComponent</h3>
<p>è°ƒç”¨ç»„ä»¶å®ä¾‹çš„renderå‡½æ•°è·å–éœ€æ¸²æŸ“çš„å­å…ƒç´ ï¼Œå¹¶æŠŠå­å…ƒç´ è¿›è¡Œå¤„ç†ä¸ºFiberç±»å‹ï¼Œå¤„ç†stateå’Œpropsï¼š</p>
<pre><code class="language-javascript">function finishClassComponent(
  current: Fiber | null,
  workInProgress: Fiber,
  shouldUpdate: boolean,
  hasContext: boolean,
  renderExpirationTime: ExpirationTime,
) {
  markRef(current, workInProgress);

  const didCaptureError = (workInProgress.effectTag &amp; DidCapture) !== NoEffect;

  if (!shouldUpdate &amp;&amp; !didCaptureError) {
    if (hasContext) {
      invalidateContextProvider(workInProgress, false);
    }

    return bailoutOnAlreadyFinishedWork(current, workInProgress);
  }

  const ctor = workInProgress.type;
  const instance = workInProgress.stateNode;

  ReactCurrentOwner.current = workInProgress;
  let nextChildren;
  if (
    didCaptureError &amp;&amp;
    (!enableGetDerivedStateFromCatch ||
      typeof ctor.getDerivedStateFromCatch !== 'function')
  ) {
    nextChildren = null;

    if (enableProfilerTimer) {
      stopBaseRenderTimerIfRunning();
    }
  } else {
    if (__DEV__) {
      ...
    } else {
    //  è°ƒç”¨renderå‡½æ•°è·å–å­å…ƒç´ 
      nextChildren = instance.render();
    }
  }

  workInProgress.effectTag |= PerformedWork;
  if (didCaptureError) {
    reconcileChildrenAtExpirationTime(
      current,
      workInProgress,
      null,
      renderExpirationTime,
    );
    workInProgress.child = null;
  }
  //  æŠŠå­å…ƒç´ è½¬æ¢ä¸ºFiberç±»å‹
  //  å¦‚æœå­å…ƒç´ æ•°é‡å¤§äºä¸€ï¼ˆå³ä¸ºæ•°ç»„ï¼‰çš„æ—¶å€™ï¼Œ
  //  è¿”å›ç¬¬ä¸€ä¸ªFiberç±»å‹å­å…ƒç´ 
  reconcileChildrenAtExpirationTime(
    current,
    workInProgress,
    nextChildren,
    renderExpirationTime,
  );
  //  å¤„ç†state
  memoizeState(workInProgress, instance.state);
  //  å¤„ç†props
  memoizeProps(workInProgress, instance.props);

  if (hasContext) {
    invalidateContextProvider(workInProgress, true);
  }

  //  è¿”å›Fiberç±»å‹çš„å­å…ƒç´ ç»™beginWorkå‡½æ•°ï¼Œ
  //  ä¸€ç›´è¿”å›åˆ°workLoopå‡½æ•°ï¼ˆçœ‹ä¸Šé¢çš„è°ƒç”¨è¿‡ç¨‹ï¼‰
  return workInProgress.child;
}
</code></pre>
<h3 id="workloop">workLoop</h3>
<p>æˆ‘ä»¬å†å›å¤´çœ‹ä¸‹workLoopå’ŒperformUnitOfWorkå‡½æ•°ï¼ˆçœ‹ä¸Šé¢çš„å‡½æ•°è°ƒç”¨è¿‡ç¨‹ï¼‰ï¼Œå½“benginWorkå¯¹ä¸åŒç±»å‹ç»„ä»¶å®Œæˆç›¸åº”å¤„ç†è¿”å›å­å…ƒç´ åï¼ŒworkLoopç»§ç»­é€šè¿‡performUnitOfWorkæ¥è°ƒç”¨benginWorkå¯¹å­å…ƒç´ è¿›è¡Œå¤„ç†ï¼Œä»è€Œéå†è™šæ‹ŸDOMæ ‘ï¼š</p>
<pre><code class="language-javascript">function workLoop(isYieldy) {
  if (!isYieldy) {
    while (nextUnitOfWork !== null) {
      //  éå†æ•´æ£µè™šæ‹ŸDOMæ ‘
      nextUnitOfWork = performUnitOfWork(nextUnitOfWork);
    }
  } else {
    while (nextUnitOfWork !== null &amp;&amp; !shouldYield()) {
      //  éå†æ•´æ£µè™šæ‹ŸDOMæ ‘
      nextUnitOfWork = performUnitOfWork(nextUnitOfWork);
    }

    if (enableProfilerTimer) {
      pauseActualRenderTimerIfRunning();
    }
  }
}
</code></pre>
<h3 id="performunitofwork">performUnitOfWork</h3>
<p>è¿™ä¸ªå‡½æ•°å¾ˆæ¥è¿‘æŠŠè™šæ‹ŸDOMè½¬æ¢ä¸ºçœŸå®DOMçš„ä»£ç å•¦ï¼Œå½“éå†å®Œæˆä¸€é¢—è™šæ‹ŸDOMçš„å­æ ‘åï¼ˆbeginWorkè¿”å›nullï¼Œå³å·²æ²¡æœ‰å­å…ƒç´ ï¼‰ï¼Œè°ƒç”¨completeUnitOfWorkå‡½æ•°å¼€å§‹è½¬æ¢ï¼š</p>
<pre><code class="language-javascript">function performUnitOfWork(workInProgress: Fiber): Fiber | null {
  const current = workInProgress.alternate;

  startWorkTimer(workInProgress);

  let next;
  if (enableProfilerTimer) {
    if (workInProgress.mode &amp; ProfileMode) {
      startBaseRenderTimer();
    }

    next = beginWork(current, workInProgress, nextRenderExpirationTime);

    if (workInProgress.mode &amp; ProfileMode) {
      recordElapsedBaseRenderTimeIfRunning(workInProgress);
      stopBaseRenderTimerIfRunning();
    }
  } else {
    next = beginWork(current, workInProgress, nextRenderExpirationTime);
  }

  if (next === null) {
    next = completeUnitOfWork(workInProgress);
  }

  ReactCurrentOwner.current = null;

  return next;
}
</code></pre>
<h3 id="completeunitofwork">completeUnitOfWork</h3>
<p>æ­¤å‡½æ•°ä½œç”¨ä¸ºå…ˆå°†å½“å‰Fiberå…ƒç´ è½¬æ¢ä¸ºçœŸå®DOMèŠ‚ç‚¹ï¼Œç„¶ååœ¨çœ‹æœ‰æ— å…„å¼ŸèŠ‚ç‚¹ï¼Œè‹¥æœ‰åˆ™è¿”å›ç»™ä¸Šå±‚å‡½æ•°å¤„ç†å®Œåå†è°ƒç”¨æ­¤å‡½æ•°è¿›è¡Œè½¬æ¢ï¼›å¦åˆ™æŸ¥çœ‹æœ‰æ— çˆ¶èŠ‚ç‚¹ï¼Œè‹¥æœ‰åˆ™è½¬æ¢çˆ¶èŠ‚ç‚¹ã€‚</p>
<pre><code class="language-javascript">function completeUnitOfWork(workInProgress: Fiber): Fiber | null {
  while (true) {
    const current = workInProgress.alternate;

    const returnFiber = workInProgress.return;
    const siblingFiber = workInProgress.sibling;

    if ((workInProgress.effectTag &amp; Incomplete) === NoEffect) {
      //  è°ƒç”¨completeWorkè½¬æ¢è™šæ‹ŸDOM
      let next = completeWork(
        current,
        workInProgress,
        nextRenderExpirationTime,
      );
      stopWorkTimer(workInProgress);
      resetExpirationTime(workInProgress, nextRenderExpirationTime);

      if (next !== null) {
        stopWorkTimer(workInProgress);
        return next;
      }

      //  å¤„ç†å®Œå½“å‰èŠ‚ç‚¹å
      if (siblingFiber !== null) {
        //  å¦‚æœæœ‰å…„å¼ŸèŠ‚ç‚¹ï¼Œåˆ™å°†å…¶è¿”å›
        return siblingFiber;
      } else if (returnFiber !== null) {
        //  æ²¡æœ‰å…„å¼ŸèŠ‚ç‚¹è€Œæœ‰çˆ¶èŠ‚ç‚¹ï¼Œåˆ™å¤„ç†çˆ¶èŠ‚ç‚¹
        workInProgress = returnFiber;
        continue;
      } else {
        return null;
      }
    } else {
      ...
  }
  
  return null;
}
</code></pre>
<h3 id="completework">completeWork</h3>
<p>æ ¹æ®Fiberçš„ç±»å‹è¿›è¡Œå¤„ç†å’ŒæŠ›å‡ºé”™è¯¯ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹HostComponentç±»å‹ã€‚å¯¹HostComponentç±»å‹çš„å¤„ç†ä¸»è¦æ˜¯æ›´æ–°å±æ€§ï¼Œç„¶åé€šè¿‡createInstanceåˆ›å»ºDOMèŠ‚ç‚¹ï¼Œå¹¶æ·»åŠ è¿›çˆ¶èŠ‚ç‚¹ã€‚</p>
<pre><code class="language-javascript">function completeWork(
  current: Fiber | null,
  workInProgress: Fiber,
  renderExpirationTime: ExpirationTime,
): Fiber | null {
  const newProps = workInProgress.pendingProps;

  if (enableProfilerTimer) {
    if (workInProgress.mode &amp; ProfileMode) {
      recordElapsedActualRenderTime(workInProgress);
    }
  }

  switch (workInProgress.tag) {
    ...
    case HostComponent: {
      popHostContext(workInProgress);
      const rootContainerInstance = getRootHostContainer();
      const type = workInProgress.type;
      if (current !== null &amp;&amp; workInProgress.stateNode != null) {
        //  æ›´æ–°å±æ€§
        const oldProps = current.memoizedProps;
        const instance: Instance = workInProgress.stateNode;
        const currentHostContext = getHostContext();
        const updatePayload = prepareUpdate(
          instance,
          type,
          oldProps,
          newProps,
          rootContainerInstance,
          currentHostContext,
        );

        updateHostComponent(
          current,
          workInProgress,
          updatePayload,
          type,
          oldProps,
          newProps,
          rootContainerInstance,
          currentHostContext,
        );

        if (current.ref !== workInProgress.ref) {
          markRef(workInProgress);
        }
      } else {
        if (!newProps) {
          ...
          return null;
        }

        const currentHostContext = getHostContext();
        let wasHydrated = popHydrationState(workInProgress);
        if (wasHydrated) {
          if (
            prepareToHydrateHostInstance(
              workInProgress,
              rootContainerInstance,
              currentHostContext,
            )
          ) {
            markUpdate(workInProgress);
          }
        } else {
          //  åˆ›å»ºå¹¶è¿”å›DOMå…ƒç´ 
          let instance = createInstance(
            type,
            newProps,
            rootContainerInstance,
            currentHostContext,
            workInProgress,
          );

          //  å°†æ­¤DOMèŠ‚ç‚¹æ·»åŠ è¿›çˆ¶èŠ‚ç‚¹
          appendAllChildren(instance, workInProgress);

          if (
            finalizeInitialChildren(
              instance,
              type,
              newProps,
              rootContainerInstance,
              currentHostContext,
            )
          ) {
            markUpdate(workInProgress);
          }
          workInProgress.stateNode = instance;
        }

        if (workInProgress.ref !== null) {
          // If there is a ref on a host node we need to schedule a callback
          markRef(workInProgress);
        }
      }
      return null;
    }
    ...
  }
}
</code></pre>
<h3 id="createinstance">createInstance</h3>
<pre><code class="language-javascript">function createInstance(
  type: string,
  props: Props,
  rootContainerInstance: Container,
  hostContext: HostContext,
  internalInstanceHandle: Object,
): Instance {
  let parentNamespace: string;
  if (__DEV__) {
    ...
  } else {
    parentNamespace = ((hostContext: any): HostContextProd);
  }
  const domElement: Instance = createElement(
    type,
    props,
    rootContainerInstance,
    parentNamespace,
  );
  precacheFiberNode(internalInstanceHandle, domElement);
  updateFiberProps(domElement, props);
  return domElement;
}
</code></pre>
<h3 id="createelement">createElement</h3>
<pre><code>function createElement(
  type: string,
  props: Object,
  rootContainerElement: Element | Document,
  parentNamespace: string,
): Element {
  let isCustomComponentTag;

  const ownerDocument: Document = getOwnerDocumentFromRootContainer(
    rootContainerElement,
  );
  let domElement: Element;
  let namespaceURI = parentNamespace;
  if (namespaceURI === HTML_NAMESPACE) {
    namespaceURI = getIntrinsicNamespace(type);
  }
  if (namespaceURI === HTML_NAMESPACE) {

    if (type === 'script') {
      const div = ownerDocument.createElement('div');
      div.innerHTML = '&lt;script&gt;&lt;' + '/script&gt;'; // eslint-disable-line
      const firstChild = ((div.firstChild: any): HTMLScriptElement);
      domElement = div.removeChild(firstChild);
    } else if (typeof props.is === 'string') {
      domElement = ownerDocument.createElement(type, {is: props.is});
    } else {
      domElement = ownerDocument.createElement(type);
    }
  } else {
    domElement = ownerDocument.createElementNS(namespaceURI, type);
  }

  return domElement;
}
</code></pre>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œâ€œReactæ˜¯å¦‚ä½•å°†è™šæ‹ŸDOMè½¬æ¢ä¸ºçœŸå®DOMâ€çš„é—®é¢˜å°±è¢«è§£å†³å•¦ã€‚æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ã€‚</p>
<ol>
<li>é¦–å…ˆæˆ‘ä»¬è¦é€šè¿‡React.createElementå‡½æ•°æ¥å°†æˆ‘ä»¬å®šä¹‰å¥½çš„ç»„ä»¶è¿›è¡Œè½¬æ¢ä¸ºReactå…ƒç´ </li>
<li>å°†åˆ›å»ºå¥½çš„Reactå…ƒç´ é€šè¿‡è°ƒç”¨ReactDom.renderæ¥è¿›è¡Œæ¸²æŸ“</li>
<li>ReactDom.renderè°ƒç”¨åå…ˆåˆ›å»ºæ ¹å¯¹è±¡rootï¼Œç„¶åè°ƒç”¨root.render</li>
<li>ç„¶åç»è¿‡è‹¥å¹²å‡½æ•°è°ƒç”¨ï¼Œæ¥åˆ°workLoopå‡½æ•°ï¼Œå®ƒå°†éå†è™šæ‹ŸDOMæ ‘ï¼Œå°†ä¸‹ä¸€ä¸ªéœ€è¦å¤„ç†çš„è™šæ‹ŸDOMä¼ ç»™performUnitOfWorkï¼ŒperformUnitOfWorkå†å°†è™šæ‹ŸDOMä¼ ç»™beginWorkåï¼ŒbeginWorkæ ¹æ®è™šæ‹ŸDOMçš„ç±»å‹ä¸åŒè¿›è¡Œç›¸åº”å¤„ç†ï¼Œå¹¶å¯¹å„¿å­è¿›è¡Œå¤„ç†ä¸ºFiberç±»å‹ï¼Œä¸ºFiberç±»å‹è™šæ‹ŸDOMæ·»åŠ çˆ¶èŠ‚ç‚¹ã€å…„å¼ŸèŠ‚ç‚¹ç­‰å¾…ç»†èŠ‚ï¼Œå·²æ–¹ä¾¿éå†æ ‘ã€‚</li>
<li>beginWorkå¤„ç†å®Œåè¿”å›éœ€è¦å¤„ç†çš„å­å…ƒç´ å†ç»§ç»­å¤„ç†ï¼Œç›´åˆ°æ²¡æœ‰å­å…ƒç´ ï¼ˆå³è¿”å›nullï¼‰ï¼Œæ­¤æ—¶performUnitOfWorkè°ƒç”¨completeUnitOfWorkå¤„ç†è¿™é¢—è™šæ‹ŸDOMå­æ ‘ï¼Œå°†å…¶è½¬æ¢ä¸ºçœŸå®DOMã€‚</li>
<li>æœ€åæ‰€æœ‰çš„è™šæ‹ŸDOMéƒ½å°†è½¬ä¸ºçœŸå®DOMã€‚</li>
</ol>
<p>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰å¾ˆå¤šç»†èŠ‚ç­‰å¾…æˆ‘ä»¬å»ç ”ç©¶ï¼Œæ¯”å¦‚è¯´Reactæ˜¯å¦‚ä½•æ›´æ–°å’Œåˆ é™¤è™šæ‹ŸDOMçš„ï¼ŸsetStateçš„å¼‚æ­¥å®ç°åŸç†æ˜¯æ€æ ·çš„ï¼Ÿä»¥åå†å†™æ–‡å’Œå¤§å®¶åˆ†æå’Œæ¢è®¨ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Reactæºç é˜…è¯»â€”â€”æ¦‚å†µ]]></title>
        <id>https://mrwindlike.github.io/Note/post/react-yuan-ma-yue-du-gai-kuang</id>
        <link href="https://mrwindlike.github.io/Note/post/react-yuan-ma-yue-du-gai-kuang">
        </link>
        <updated>2019-04-30T14:55:07.000Z</updated>
        <summary type="html"><![CDATA[<p>æœ¬æ–‡å°†ä»‹ç»Reactæºç çš„é¡¹ç›®ç»“æ„ã€ä¸»è¦æ€æƒ³ã€è®¾è®¡åŸåˆ™å’Œç›¸å…³æ¦‚å¿µï¼Œä¸ºé˜…è¯»æºç åšå¥½å‡†å¤‡ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æœ¬æ–‡å°†ä»‹ç»Reactæºç çš„é¡¹ç›®ç»“æ„ã€ä¸»è¦æ€æƒ³ã€è®¾è®¡åŸåˆ™å’Œç›¸å…³æ¦‚å¿µï¼Œä¸ºé˜…è¯»æºç åšå¥½å‡†å¤‡ã€‚</p>
<!-- more -->
<h1 id="å‰è¨€">å‰è¨€</h1>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸€äº›Reactçš„è®¾è®¡æ€æƒ³å’Œç›¸å…³æ¦‚å¿µï¼Œä¸ç®¡æ˜¯æƒ³è¦é˜…è¯»æºç è¿˜æ˜¯æƒ³æ·±å…¥äº†è§£Reactçš„åŒå­¦çœ‹è¿‡æ¥å‘€ã€‚æ¬¢è¿æŒ‡å‡ºé”™è¯¯ï¼Œä¸€èµ·æ¢è®¨ä¸€èµ·è¿›æ­¥ã€‚</p>
<h2 id="åŒç³»åˆ—æ–‡ç« ">åŒç³»åˆ—æ–‡ç« </h2>
<p>å› ä¸ºæ¯æ¬¡æ›´æ–°æ–‡ç« éƒ½è¦æ›´æ–°ä¸€éç›®å½•å¤ªéº»çƒ¦ï¼Œæ‰€ä»¥æœ¬ç³»åˆ—çš„æ–‡ç« éƒ½æ•´åˆåˆ°Githubï¼Œæœ‰å…´è¶£é˜…è¯»æ›´å¤šReactæºç é˜…è¯»æ–‡ç« çš„åŒå­¦å¯ä»¥ç”¨åŠ›ç‚¹<a href="https://github.com/MrWindlike/React-Source-Reading">è¿™é‡Œè¿™é‡Œè¿™é‡Œ</a>ï¼Œå¦‚æœè§‰å¾—æ–‡ç« å†™å¾—è¿˜è¡Œçš„è¯ï¼Œå¯¹ä½ æœ‰å°å°çš„å¸®åŠ©ï¼Œå¸Œæœ›å¯ä»¥ç»™é¢—å°æ˜Ÿæ˜Ÿç»™æˆ‘ï¼Œè°¢è°¢ğŸ˜œ</p>
<h1 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</h1>
<p>Reactçš„ç›¸å…³ä»£ç éƒ½æ”¾åœ¨packagesé‡Œã€‚</p>
<pre><code>â”œâ”€â”€ packages ------------------------------- Reactå®ç°çš„ç›¸å…³ä»£ç 
â”‚   â”œâ”€â”€ create-subscription ------------------------- åœ¨ç»„ä»¶é‡Œè®¢é˜…é¢å¤–æ•°æ®çš„å·¥å…·
â”‚   â”œâ”€â”€ events -------------------------- Reactäº‹ä»¶ç›¸å…³
â”‚   â”œâ”€â”€ react-art ------------------------- ç”»å›¾ç›¸å…³åº“
â”‚   â”œâ”€â”€ react-dom -------------------------- ReactDom
â”‚   â”œâ”€â”€ react-native-renderer ----------------------------- ReactNative
â”‚   â”œâ”€â”€ react-reconciler ------------------------ Reactè°ƒåˆ¶å™¨
â”‚   â”œâ”€â”€ react-scheduler ------------------------ è§„åˆ’Reactåˆå§‹åŒ–ï¼Œæ›´æ–°ç­‰ç­‰
â”‚   â”œâ”€â”€ react-test-renderer ------------------------ å®éªŒæ€§çš„Reactæ¸²æŸ“å™¨
â”‚   â”œâ”€â”€ shared ------------------------ å…¬å…±ä»£ç 
â”‚   â”œâ”€â”€ simple-cache-provider ------------------------ ä¸ºReactåº”ç”¨æä¾›ç¼“å­˜
</code></pre>
<h1 id="ä¸»è¦æ€æƒ³å’Œè®¾è®¡åŸåˆ™">ä¸»è¦æ€æƒ³å’Œè®¾è®¡åŸåˆ™</h1>
<h2 id="ç»„åˆ">ç»„åˆ</h2>
<p>Reactçš„ä¸»è¦ç‰¹æ€§å°±æ˜¯å„ç§ç»„åˆè€Œæˆçš„ç»„ä»¶ã€‚ç”±ä¸åŒäººç¼–å†™çš„ç»„ä»¶å¯ä»¥ç»„åˆä½¿ç”¨ï¼Œå¹¶ä¸”å®ç°ç»„ä»¶çš„å¤ç”¨ã€‚</p>
<h2 id="æ—¶åºå®‰æ’scheduling">æ—¶åºå®‰æ’(Scheduling)</h2>
<p>Reactçš„åˆå§‹åŒ–ï¼Œæ›´æ–°ï¼Œç§»é™¤ç­‰ç­‰æ“ä½œå¹¶ä¸æ˜¯åŒæ­¥çš„ï¼Œç”¨æˆ·ç¼–å†™çš„ç»„ä»¶(å¦‚<code>&lt;ReactComponent/&gt;</code>)æˆ–è€…å¹³å°ç‰¹å®šç»„ä»¶(å¦‚<code>&lt;div/&gt;</code>)è¿™äº›åªæ˜¯è¿”å›éœ€è¦æ¸²æŸ“çš„ä¿¡æ¯ï¼Œå¹¶ä¸æ˜¯çœŸå®DOMï¼Œæˆ‘ä»¬é€šå¸¸ç§°ä»–ä»¬ä¸ºè™šæ‹ŸDOMï¼ŒReactä¼šéå†è¿™é¢—è™šæ‹ŸDOMæ ‘æ¥æ¸²æŸ“çœŸå®çš„DOMæ ‘ã€‚</p>
<p>è€Œä¸”<code>setState()</code>ä¹Ÿå¹¶ä¸æ˜¯åŒæ­¥çš„ï¼Œä»–ä»¬çš„å¤šæ¬¡è°ƒç”¨æ›´æ–°ä¼šè¢«æ•´åˆä¸ºä¸€æ¬¡æ›´æ–°ï¼ŒåŠ å…¥æ›´æ–°é˜Ÿåˆ—ç„¶åç­‰å¾…æ›´æ–°ï¼Œå†å»æ¸²æŸ“çœŸå®çš„DOMæ ‘ï¼Œå› ä¸ºDOMå‹çš„æ“ä½œé€šå¸¸æ˜¯å¾ˆè€—æ—¶çš„ï¼Œæ‰€ä»¥å°½é‡å‡å°‘DOMç›¸å…³æ“ä½œã€‚</p>
<h2 id="domä¹‹å¤–">DOMä¹‹å¤–</h2>
<p>Reactçš„ä¸€ä¸ªä¸»è¦ç‰¹ç‚¹ä¸ºç¼–å†™çš„ä»£ç å¯ä»¥é€šè¿‡å·¥å…·(å¦‚ReactNativeï¼ŒElectron)åœ¨å¤šä¸ªå¹³å°ä¸Šè¿è¡Œï¼Œå› æ­¤æ¸²æŸ“å‡ºæ¥çš„å…ƒç´ å¯èƒ½ä¸æ˜¯DOMï¼Œå› æ­¤Reactå°†ä»–ä»¬åˆ†ä¸ºä¸¤ä¸ªæ¨¡å—ï¼Œä¸€ä¸ªæ¨¡å—ä¸ºreconciler(è°ƒèŠ‚å™¨)ï¼Œå®ƒæ ¹æ®ç”¨æˆ·ç¼–å†™çš„ç»„ä»¶è½¬æ¢ä¸ºReactå¯ä»¥è¯†åˆ«çš„å…ƒç´ (å³è™šæ‹ŸDOM)ï¼›å¦ä¸€ä¸ªæ¨¡å—ä¸ºrenderer(æ¸²æŸ“å™¨ï¼Œåˆ†ä¸ºDOMæ¸²æŸ“å™¨å’ŒNativeæ¸²æŸ“å™¨)ï¼Œå®ƒçš„ä½œç”¨ä¸ºæ ¹æ®è™šæ‹ŸDOMæ¸²æŸ“ä¸ºå¹³å°ç‰¹å®šçš„å…ƒç´ ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯å¯ä»¥æ–¹ä¾¿Reactå¯ä»¥åœ¨å¤šå¹³å°ä¸Šè¿è¡Œï¼Œè€Œä¸å¿…å¤ªè¿‡å…³æ³¨reconcilerçš„ä»£ç ã€‚</p>
<h1 id="ç›¸å…³æ¦‚å¿µ">ç›¸å…³æ¦‚å¿µ</h1>
<h2 id="fiber">Fiber</h2>
<h3 id="ä»€ä¹ˆæ˜¯fiber">ä»€ä¹ˆæ˜¯Fiberï¼Ÿ</h3>
<p>Fiberæ˜¯Reactç‰ˆæœ¬16ä»¥åçš„é‡è¦æ¦‚å¿µã€‚</p>
<p>Fiberçš„ä¸»è¦ç›®æ ‡ä¸ºï¼š</p>
<ul>
<li>å…ˆæš‚åœç›®å‰çš„å·¥ä½œå»å¤„ç†ä¼˜å…ˆçº§æ›´é«˜çš„å·¥ä½œï¼Œç„¶åå†å›æ¥ç»§ç»­</li>
<li>ä¸ºä¸åŒçš„å·¥ä½œè®¾å®šä¸åŒä¼˜å…ˆçº§</li>
<li>é‡ç”¨ä¹‹å‰å®Œæˆçš„å·¥ä½œ</li>
<li>ç»ˆæ­¢ä¸å†éœ€è¦çš„å·¥ä½œ</li>
</ul>
<p>æˆ‘ä»¬éƒ½çŸ¥é“è°ƒç”¨å‡½æ•°æ—¶ä¼šæŠŠå®ƒåŠ å…¥æ‰§è¡Œæ ˆä¸­ï¼Œç­‰å‡½æ•°æ‰§è¡Œå®Œåå†é€€å‡ºæ ˆï¼Œé‚£æœ‰æ²¡æœ‰åŠæ³•å¯ä»¥å®šåˆ¶æ ˆçš„è°ƒç”¨ä»¥æ›´å¥½åœ°ä¼˜åŒ–æ¸²æŸ“UIå‘¢ï¼Ÿè¿™å°±æ˜¯Fiberæƒ³è¦è§£å†³çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç§°å•ä¸ªFiberä¸ºè™šæ‹Ÿçš„æ ˆå¸§ï¼Œå®ƒæ˜¯å®ç°Reactæ—¶åºå®‰æ’çš„å…³é”®ã€‚</p>
<h3 id="fiberçš„ç»“æ„">Fiberçš„ç»“æ„</h3>
<pre><code class="language-js">type Fiber = {|
  //  è¾¨è¯†ç»„ä»¶ç›¸å…³çš„å±æ€§
  tag: TypeOfWork,
  key: null | string,
  type: any,
  
  //  çˆ¶Fiberæˆ–è€…null
  return: Fiber | null,

  child: Fiber | null,
  sibling: Fiber | null,
  index: number,
  ref: null | (((handle: mixed) =&gt; void) &amp; {_stringRef: ?string}) | RefObject,

  memoizedProps: any, // The props used to create the output.
  updateQueue: UpdateQueue&lt;any&gt; | null,
  memoizedState: any,
  
  mode: TypeOfMode,

  effectTag: TypeOfSideEffect,
  nextEffect: Fiber | null,
  firstEffect: Fiber | null,
  lastEffect: Fiber | null,
  
  expirationTime: ExpirationTime,

  alternate: Fiber | null,

  //  æ—¶é—´
  actualDuration?: number,
  actualStartTime?: number,
  selfBaseTime?: number,
  treeBaseTime?: number,

 //  è°ƒè¯•
  _debugID?: number,
  _debugSource?: Source | null,
  _debugOwner?: Fiber | null,
  _debugIsCurrentlyTiming?: boolean,
|};
</code></pre>
<h4 id="key-type"><code>key</code>ã€<code>type</code></h4>
<p>è¿™ä¸¤ä¸ªå±æ€§éƒ½æ˜¯ç”¨æ¥è¡¨ç¤ºç»„ä»¶çš„ï¼Œæ›´æ–°ç»„ä»¶çš„æ—¶å€™å…ˆæ£€æŸ¥<code>key</code>æ˜¯å¦æœ‰æ”¹å˜ï¼Œå¦‚æœæ”¹å˜çš„è¯åˆ™ç›´æ¥æ‘§æ¯é‡å»ºï¼›ä¸å˜çš„è¯åˆ™ç»§ç»­æ£€æŸ¥<code>type</code>æ˜¯å¦æ”¹å˜ï¼Œæ”¹å˜åˆ™ç›´æ¥æ‘§æ¯é‡å»ºï¼›å¦åˆ™é‡ç”¨åŸæ¥çš„ç»„ä»¶ï¼Œåªæ˜¯æ”¹å˜ç»„ä»¶çš„å±æ€§ã€‚<code>type</code>å¯èƒ½æ˜¯ç”¨æˆ·å®šä¹‰çš„å‡½æ•°å‹æˆ–è€…ç±»å‹çš„ç»„åˆå‹ç»„ä»¶ï¼Œæˆ–è€…æ˜¯ä»£è¡¨å¹³å°å…ƒç´ çš„å­—ç¬¦ä¸²(å¦‚<code>'div'</code>)ã€‚</p>
<h3 id="pendingprops-memoizedprops"><code>pendingProps</code>ã€<code>memoizedProps</code></h3>
<p>æ¦‚å¿µä¸Šæ¥è¯´ï¼Œ<code>props</code>å°±æ˜¯ä¸€ä¸ªå‡½æ•°çš„å‚æ•°æ•°ç»„ã€‚<code>pendingProps</code>æ˜¯Fiberå¼€å§‹æ‰§è¡Œçš„æ—¶å€™è¢«è®¾å®šçš„ï¼Œ<code>memoizedProps</code>åœ¨æ‰§è¡Œå®Œä¹‹åã€‚æ¯æ¬¡æ›´æ–°çš„æ—¶å€™å…ˆæ¯”è¾ƒ<code>pendingProps</code>å’Œ<code>memoizedProps</code>ï¼Œå¦‚æœå®ƒä»¬ç›¸åŒï¼Œåˆ™è¡¨ç¤ºå…ˆå‰çš„è¾“å‡ºå¯ä»¥é‡ç”¨ï¼Œè€Œä¸å¿…è¿›è¡Œå¤šä½™çš„å·¥ä½œã€‚</p>
<h3 id="pendingworkpriority"><code>pendingWorkPriority</code></h3>
<p>ä¸€ä¸ªè¡¨é¢å·¥ä½œä¼˜å…ˆæƒçš„å±æ€§ã€‚é™¤<code>NoWork</code>(å®ƒçš„å€¼ä¸º0)ä»¥å¤–ï¼Œæ•°å€¼è¶Šå¤§ä»£è¡¨æœ‰é™æƒè¶Šä½ã€‚</p>
<pre><code class="language-js">function matchesPriority(fiber, priority) {
  return fiber.pendingWorkPriority !== 0 &amp;&amp;
         fiber.pendingWorkPriority &lt;= priority
}
</code></pre>
<h1 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h1>
<ul>
<li><a href="https://github.com/acdlite/react-fiber-architecture">React Fiber Architecture</a></li>
<li><a href="https://reactjs.org/docs/codebase-overview.html">Codebase Overview</a></li>
<li><a href="https://reactjs.org/docs/design-principles.html">Design Principles</a></li>
</ul>
]]></content>
    </entry>
</feed>