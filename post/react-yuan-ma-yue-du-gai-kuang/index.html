<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Reactæºç é˜…è¯»â€”â€”æ¦‚å†µ | Windlikeçš„å°å±‹å­</title>
<meta name="description" content="æ¸©æ•…è€ŒçŸ¥æ–°">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://mrwindlike.github.io/Note/favicon.ico?v=1565014414962">
<link rel="stylesheet" href="https://mrwindlike.github.io/Note/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />



  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://mrwindlike.github.io/Note">
        <img src="https://mrwindlike.github.io/Note/images/avatar.png?v=1565014414962" class="site-logo">
        <h1 class="site-title">Windlikeçš„å°å±‹å­</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="https://mrwindlike.github.io/Note" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="https://mrwindlike.github.io/Note/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="https://juejin.im/user/59f6e985f265da431d3bf69f" class="site-nav">
            æ˜é‡‘
          </a>
        
      
        
          <a href="https://github.com/MrWindlike" class="site-nav">
            Github
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/MrWindlike" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      æ¸©æ•…è€ŒçŸ¥æ–°
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Reactæºç é˜…è¯»â€”â€”æ¦‚å†µ</h2>
            <div class="post-date">2019-04-30</div>
            
              <div class="feature-container" style="background-image: url('https://code.fb.com/wp-content/uploads/2017/09/react_16_sized.jpg')">
              </div>
            
            <div class="post-content">
              <p>æœ¬æ–‡å°†ä»‹ç»Reactæºç çš„é¡¹ç›®ç»“æ„ã€ä¸»è¦æ€æƒ³ã€è®¾è®¡åŸåˆ™å’Œç›¸å…³æ¦‚å¿µï¼Œä¸ºé˜…è¯»æºç åšå¥½å‡†å¤‡ã€‚</p>
<!-- more -->
<h1 id="å‰è¨€">å‰è¨€</h1>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸€äº›Reactçš„è®¾è®¡æ€æƒ³å’Œç›¸å…³æ¦‚å¿µï¼Œä¸ç®¡æ˜¯æƒ³è¦é˜…è¯»æºç è¿˜æ˜¯æƒ³æ·±å…¥äº†è§£Reactçš„åŒå­¦çœ‹è¿‡æ¥å‘€ã€‚æ¬¢è¿æŒ‡å‡ºé”™è¯¯ï¼Œä¸€èµ·æ¢è®¨ä¸€èµ·è¿›æ­¥ã€‚</p>
<h2 id="åŒç³»åˆ—æ–‡ç« ">åŒç³»åˆ—æ–‡ç« </h2>
<p>å› ä¸ºæ¯æ¬¡æ›´æ–°æ–‡ç« éƒ½è¦æ›´æ–°ä¸€éç›®å½•å¤ªéº»çƒ¦ï¼Œæ‰€ä»¥æœ¬ç³»åˆ—çš„æ–‡ç« éƒ½æ•´åˆåˆ°Githubï¼Œæœ‰å…´è¶£é˜…è¯»æ›´å¤šReactæºç é˜…è¯»æ–‡ç« çš„åŒå­¦å¯ä»¥ç”¨åŠ›ç‚¹<a href="https://github.com/MrWindlike/React-Source-Reading">è¿™é‡Œè¿™é‡Œè¿™é‡Œ</a>ï¼Œå¦‚æœè§‰å¾—æ–‡ç« å†™å¾—è¿˜è¡Œçš„è¯ï¼Œå¯¹ä½ æœ‰å°å°çš„å¸®åŠ©ï¼Œå¸Œæœ›å¯ä»¥ç»™é¢—å°æ˜Ÿæ˜Ÿç»™æˆ‘ï¼Œè°¢è°¢ğŸ˜œ</p>
<h1 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</h1>
<p>Reactçš„ç›¸å…³ä»£ç éƒ½æ”¾åœ¨packagesé‡Œã€‚</p>
<pre><code>â”œâ”€â”€ packages ------------------------------- Reactå®ç°çš„ç›¸å…³ä»£ç 
â”‚   â”œâ”€â”€ create-subscription ------------------------- åœ¨ç»„ä»¶é‡Œè®¢é˜…é¢å¤–æ•°æ®çš„å·¥å…·
â”‚   â”œâ”€â”€ events -------------------------- Reactäº‹ä»¶ç›¸å…³
â”‚   â”œâ”€â”€ react-art ------------------------- ç”»å›¾ç›¸å…³åº“
â”‚   â”œâ”€â”€ react-dom -------------------------- ReactDom
â”‚   â”œâ”€â”€ react-native-renderer ----------------------------- ReactNative
â”‚   â”œâ”€â”€ react-reconciler ------------------------ Reactè°ƒåˆ¶å™¨
â”‚   â”œâ”€â”€ react-scheduler ------------------------ è§„åˆ’Reactåˆå§‹åŒ–ï¼Œæ›´æ–°ç­‰ç­‰
â”‚   â”œâ”€â”€ react-test-renderer ------------------------ å®éªŒæ€§çš„Reactæ¸²æŸ“å™¨
â”‚   â”œâ”€â”€ shared ------------------------ å…¬å…±ä»£ç 
â”‚   â”œâ”€â”€ simple-cache-provider ------------------------ ä¸ºReactåº”ç”¨æä¾›ç¼“å­˜
</code></pre>
<h1 id="ä¸»è¦æ€æƒ³å’Œè®¾è®¡åŸåˆ™">ä¸»è¦æ€æƒ³å’Œè®¾è®¡åŸåˆ™</h1>
<h2 id="ç»„åˆ">ç»„åˆ</h2>
<p>Reactçš„ä¸»è¦ç‰¹æ€§å°±æ˜¯å„ç§ç»„åˆè€Œæˆçš„ç»„ä»¶ã€‚ç”±ä¸åŒäººç¼–å†™çš„ç»„ä»¶å¯ä»¥ç»„åˆä½¿ç”¨ï¼Œå¹¶ä¸”å®ç°ç»„ä»¶çš„å¤ç”¨ã€‚</p>
<h2 id="æ—¶åºå®‰æ’scheduling">æ—¶åºå®‰æ’(Scheduling)</h2>
<p>Reactçš„åˆå§‹åŒ–ï¼Œæ›´æ–°ï¼Œç§»é™¤ç­‰ç­‰æ“ä½œå¹¶ä¸æ˜¯åŒæ­¥çš„ï¼Œç”¨æˆ·ç¼–å†™çš„ç»„ä»¶(å¦‚<code>&lt;ReactComponent/&gt;</code>)æˆ–è€…å¹³å°ç‰¹å®šç»„ä»¶(å¦‚<code>&lt;div/&gt;</code>)è¿™äº›åªæ˜¯è¿”å›éœ€è¦æ¸²æŸ“çš„ä¿¡æ¯ï¼Œå¹¶ä¸æ˜¯çœŸå®DOMï¼Œæˆ‘ä»¬é€šå¸¸ç§°ä»–ä»¬ä¸ºè™šæ‹ŸDOMï¼ŒReactä¼šéå†è¿™é¢—è™šæ‹ŸDOMæ ‘æ¥æ¸²æŸ“çœŸå®çš„DOMæ ‘ã€‚</p>
<p>è€Œä¸”<code>setState()</code>ä¹Ÿå¹¶ä¸æ˜¯åŒæ­¥çš„ï¼Œä»–ä»¬çš„å¤šæ¬¡è°ƒç”¨æ›´æ–°ä¼šè¢«æ•´åˆä¸ºä¸€æ¬¡æ›´æ–°ï¼ŒåŠ å…¥æ›´æ–°é˜Ÿåˆ—ç„¶åç­‰å¾…æ›´æ–°ï¼Œå†å»æ¸²æŸ“çœŸå®çš„DOMæ ‘ï¼Œå› ä¸ºDOMå‹çš„æ“ä½œé€šå¸¸æ˜¯å¾ˆè€—æ—¶çš„ï¼Œæ‰€ä»¥å°½é‡å‡å°‘DOMç›¸å…³æ“ä½œã€‚</p>
<h2 id="domä¹‹å¤–">DOMä¹‹å¤–</h2>
<p>Reactçš„ä¸€ä¸ªä¸»è¦ç‰¹ç‚¹ä¸ºç¼–å†™çš„ä»£ç å¯ä»¥é€šè¿‡å·¥å…·(å¦‚ReactNativeï¼ŒElectron)åœ¨å¤šä¸ªå¹³å°ä¸Šè¿è¡Œï¼Œå› æ­¤æ¸²æŸ“å‡ºæ¥çš„å…ƒç´ å¯èƒ½ä¸æ˜¯DOMï¼Œå› æ­¤Reactå°†ä»–ä»¬åˆ†ä¸ºä¸¤ä¸ªæ¨¡å—ï¼Œä¸€ä¸ªæ¨¡å—ä¸ºreconciler(è°ƒèŠ‚å™¨)ï¼Œå®ƒæ ¹æ®ç”¨æˆ·ç¼–å†™çš„ç»„ä»¶è½¬æ¢ä¸ºReactå¯ä»¥è¯†åˆ«çš„å…ƒç´ (å³è™šæ‹ŸDOM)ï¼›å¦ä¸€ä¸ªæ¨¡å—ä¸ºrenderer(æ¸²æŸ“å™¨ï¼Œåˆ†ä¸ºDOMæ¸²æŸ“å™¨å’ŒNativeæ¸²æŸ“å™¨)ï¼Œå®ƒçš„ä½œç”¨ä¸ºæ ¹æ®è™šæ‹ŸDOMæ¸²æŸ“ä¸ºå¹³å°ç‰¹å®šçš„å…ƒç´ ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯å¯ä»¥æ–¹ä¾¿Reactå¯ä»¥åœ¨å¤šå¹³å°ä¸Šè¿è¡Œï¼Œè€Œä¸å¿…å¤ªè¿‡å…³æ³¨reconcilerçš„ä»£ç ã€‚</p>
<h1 id="ç›¸å…³æ¦‚å¿µ">ç›¸å…³æ¦‚å¿µ</h1>
<h2 id="fiber">Fiber</h2>
<h3 id="ä»€ä¹ˆæ˜¯fiber">ä»€ä¹ˆæ˜¯Fiberï¼Ÿ</h3>
<p>Fiberæ˜¯Reactç‰ˆæœ¬16ä»¥åçš„é‡è¦æ¦‚å¿µã€‚</p>
<p>Fiberçš„ä¸»è¦ç›®æ ‡ä¸ºï¼š</p>
<ul>
<li>å…ˆæš‚åœç›®å‰çš„å·¥ä½œå»å¤„ç†ä¼˜å…ˆçº§æ›´é«˜çš„å·¥ä½œï¼Œç„¶åå†å›æ¥ç»§ç»­</li>
<li>ä¸ºä¸åŒçš„å·¥ä½œè®¾å®šä¸åŒä¼˜å…ˆçº§</li>
<li>é‡ç”¨ä¹‹å‰å®Œæˆçš„å·¥ä½œ</li>
<li>ç»ˆæ­¢ä¸å†éœ€è¦çš„å·¥ä½œ</li>
</ul>
<p>æˆ‘ä»¬éƒ½çŸ¥é“è°ƒç”¨å‡½æ•°æ—¶ä¼šæŠŠå®ƒåŠ å…¥æ‰§è¡Œæ ˆä¸­ï¼Œç­‰å‡½æ•°æ‰§è¡Œå®Œåå†é€€å‡ºæ ˆï¼Œé‚£æœ‰æ²¡æœ‰åŠæ³•å¯ä»¥å®šåˆ¶æ ˆçš„è°ƒç”¨ä»¥æ›´å¥½åœ°ä¼˜åŒ–æ¸²æŸ“UIå‘¢ï¼Ÿè¿™å°±æ˜¯Fiberæƒ³è¦è§£å†³çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç§°å•ä¸ªFiberä¸ºè™šæ‹Ÿçš„æ ˆå¸§ï¼Œå®ƒæ˜¯å®ç°Reactæ—¶åºå®‰æ’çš„å…³é”®ã€‚</p>
<h3 id="fiberçš„ç»“æ„">Fiberçš„ç»“æ„</h3>
<pre><code class="language-js">type Fiber = {|
  //  è¾¨è¯†ç»„ä»¶ç›¸å…³çš„å±æ€§
  tag: TypeOfWork,
  key: null | string,
  type: any,
  
  //  çˆ¶Fiberæˆ–è€…null
  return: Fiber | null,

  child: Fiber | null,
  sibling: Fiber | null,
  index: number,
  ref: null | (((handle: mixed) =&gt; void) &amp; {_stringRef: ?string}) | RefObject,

  memoizedProps: any, // The props used to create the output.
  updateQueue: UpdateQueue&lt;any&gt; | null,
  memoizedState: any,
  
  mode: TypeOfMode,

  effectTag: TypeOfSideEffect,
  nextEffect: Fiber | null,
  firstEffect: Fiber | null,
  lastEffect: Fiber | null,
  
  expirationTime: ExpirationTime,

  alternate: Fiber | null,

  //  æ—¶é—´
  actualDuration?: number,
  actualStartTime?: number,
  selfBaseTime?: number,
  treeBaseTime?: number,

 //  è°ƒè¯•
  _debugID?: number,
  _debugSource?: Source | null,
  _debugOwner?: Fiber | null,
  _debugIsCurrentlyTiming?: boolean,
|};
</code></pre>
<h4 id="key-type"><code>key</code>ã€<code>type</code></h4>
<p>è¿™ä¸¤ä¸ªå±æ€§éƒ½æ˜¯ç”¨æ¥è¡¨ç¤ºç»„ä»¶çš„ï¼Œæ›´æ–°ç»„ä»¶çš„æ—¶å€™å…ˆæ£€æŸ¥<code>key</code>æ˜¯å¦æœ‰æ”¹å˜ï¼Œå¦‚æœæ”¹å˜çš„è¯åˆ™ç›´æ¥æ‘§æ¯é‡å»ºï¼›ä¸å˜çš„è¯åˆ™ç»§ç»­æ£€æŸ¥<code>type</code>æ˜¯å¦æ”¹å˜ï¼Œæ”¹å˜åˆ™ç›´æ¥æ‘§æ¯é‡å»ºï¼›å¦åˆ™é‡ç”¨åŸæ¥çš„ç»„ä»¶ï¼Œåªæ˜¯æ”¹å˜ç»„ä»¶çš„å±æ€§ã€‚<code>type</code>å¯èƒ½æ˜¯ç”¨æˆ·å®šä¹‰çš„å‡½æ•°å‹æˆ–è€…ç±»å‹çš„ç»„åˆå‹ç»„ä»¶ï¼Œæˆ–è€…æ˜¯ä»£è¡¨å¹³å°å…ƒç´ çš„å­—ç¬¦ä¸²(å¦‚<code>'div'</code>)ã€‚</p>
<h3 id="pendingprops-memoizedprops"><code>pendingProps</code>ã€<code>memoizedProps</code></h3>
<p>æ¦‚å¿µä¸Šæ¥è¯´ï¼Œ<code>props</code>å°±æ˜¯ä¸€ä¸ªå‡½æ•°çš„å‚æ•°æ•°ç»„ã€‚<code>pendingProps</code>æ˜¯Fiberå¼€å§‹æ‰§è¡Œçš„æ—¶å€™è¢«è®¾å®šçš„ï¼Œ<code>memoizedProps</code>åœ¨æ‰§è¡Œå®Œä¹‹åã€‚æ¯æ¬¡æ›´æ–°çš„æ—¶å€™å…ˆæ¯”è¾ƒ<code>pendingProps</code>å’Œ<code>memoizedProps</code>ï¼Œå¦‚æœå®ƒä»¬ç›¸åŒï¼Œåˆ™è¡¨ç¤ºå…ˆå‰çš„è¾“å‡ºå¯ä»¥é‡ç”¨ï¼Œè€Œä¸å¿…è¿›è¡Œå¤šä½™çš„å·¥ä½œã€‚</p>
<h3 id="pendingworkpriority"><code>pendingWorkPriority</code></h3>
<p>ä¸€ä¸ªè¡¨é¢å·¥ä½œä¼˜å…ˆæƒçš„å±æ€§ã€‚é™¤<code>NoWork</code>(å®ƒçš„å€¼ä¸º0)ä»¥å¤–ï¼Œæ•°å€¼è¶Šå¤§ä»£è¡¨æœ‰é™æƒè¶Šä½ã€‚</p>
<pre><code class="language-js">function matchesPriority(fiber, priority) {
  return fiber.pendingWorkPriority !== 0 &amp;&amp;
         fiber.pendingWorkPriority &lt;= priority
}
</code></pre>
<h1 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h1>
<ul>
<li><a href="https://github.com/acdlite/react-fiber-architecture">React Fiber Architecture</a></li>
<li><a href="https://reactjs.org/docs/codebase-overview.html">Codebase Overview</a></li>
<li><a href="https://reactjs.org/docs/design-principles.html">Design Principles</a></li>
</ul>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://mrwindlike.github.io/Note/tag/front-end" class="tag">
                    å‰ç«¯
                  </a>
                
                  <a href="https://mrwindlike.github.io/Note/tag/react" class="tag">
                    React
                  </a>
                
              </div>
            
            

            
              
                <div id="gitalk-container" data-aos="fade-in"></div>
              

              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  
  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: '',
        owner: '',
        admin: [''],
        id: location.pathname,      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
